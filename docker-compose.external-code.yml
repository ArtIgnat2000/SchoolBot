version: '3.8'

services:
  school-bot:
    build: .
    container_name: school-bot-external-code
    restart: unless-stopped
    
    # üìÅ –í–ù–ï–®–ù–ò–ô –ö–û–î - –º–æ–Ω—Ç–∏—Ä—É–µ–º –∫–æ–¥ —Å —Ö–æ—Å—Ç–∞
    volumes:
      # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞
      - ./main.py:/app/main.py
      - ./config.py:/app/config.py
      - ./utils.py:/app/utils.py
      - ./keyboards.py:/app/keyboards.py
      - ./handlers:/app/handlers
      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
      - ./.env:/app/.env
    
    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONPATH=/app
    
    # –ó–∞–≥—Ä—É–∑–∫–∞ .env —Ñ–∞–π–ª–∞
    env_file:
      - .env
    
    # –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ (–æ—Å—Ç–∞–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π)
    command: python main.py
    
    # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    
    # –†–µ—Å—É—Ä—Å—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    deploy:
      resources:
        limits:
          memory: 256M
          cpus: '0.5'
        reservations:
          memory: 128M
          cpus: '0.25'
    
    # Healthcheck
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s